<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Engineering Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.6/dist/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .upload-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed rgba(255,255,255,0.5);
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: white;
            background: rgba(255,255,255,0.1);
        }

        .upload-area.dragover {
            border-color: white;
            background: rgba(255,255,255,0.2);
            transform: scale(1.02);
        }

        .upload-btn {
            background: white;
            color: #f5576c;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .analysis-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .analysis-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .schema-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .code-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .kpi-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .visualization-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            border: 1px solid #e9ecef;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .result-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-item ul {
            list-style: none;
            padding-left: 0;
        }

        .result-item li {
            padding: 5px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .result-item li:last-child {
            border-bottom: none;
        }

        .kpi-input {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .kpi-textarea {
            width: 100%;
            min-height: 120px;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            resize: vertical;
            margin: 15px 0;
        }

        .analyze-btn {
            background: white;
            color: #00f2fe;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            border-radius: 10px;
            padding: 15px;
            color: #cc0000;
            margin: 15px 0;
        }

        .success {
            background: #e6ffe6;
            border: 1px solid #99ff99;
            border-radius: 10px;
            padding: 15px;
            color: #006600;
            margin: 15px 0;
        }

        .hierarchy-tree {
            font-family: monospace;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .tree-node {
            padding: 5px 0;
            border-left: 2px solid #e9ecef;
            padding-left: 20px;
            margin-left: 10px;
        }

        .tree-node.root {
            border-left: none;
            margin-left: 0;
            padding-left: 0;
            font-weight: bold;
            color: #667eea;
        }

        .relationship-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .improvement-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .improvement-item h5 {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .improvement-item p {
            opacity: 0.9;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Data Engineering Analyzer</h1>
            <p>Privacy-first analysis with AI-powered insights</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <div class="tab active" data-tab="database">üìä Database Analysis</div>
                <div class="tab" data-tab="code">üíª Code Analysis</div>
                <div class="tab" data-tab="kpi">üìà KPI Analysis</div>
                <div class="tab" data-tab="results">üìã Results</div>
            </div>

            <!-- Database Analysis Tab -->
            <div class="tab-content active" id="database">
                <div class="upload-section">
                    <h2>Database Schema Analysis</h2>
                    <p>Upload your database schema files (SQL, DDL, SQLite) for comprehensive analysis</p>
                    
                    <div class="upload-area" id="db-upload-area">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üìÅ</div>
                        <h3>Drop your database files here</h3>
                        <p>or click to browse</p>
                        <button class="upload-btn" onclick="document.getElementById('db-file-input').click()">
                            Choose Files
                        </button>
                        <input type="file" id="db-file-input" style="display: none;" 
                               accept=".sql,.ddl,.db,.sqlite" multiple>
                    </div>
                </div>

                <div class="analysis-section" id="db-analysis" style="display: none;">
                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon schema-icon">üóÑÔ∏è</div>
                            <div class="card-title">Schema Overview</div>
                        </div>
                        <div id="schema-overview"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon schema-icon">üîó</div>
                            <div class="card-title">Table Relationships</div>
                        </div>
                        <div class="visualization-container" id="relationships-viz"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon schema-icon">üå≥</div>
                            <div class="card-title">Data Hierarchy</div>
                        </div>
                        <div id="hierarchy-display"></div>
                    </div>
                </div>
            </div>

            <!-- Code Analysis Tab -->
            <div class="tab-content" id="code">
                <div class="upload-section">
                    <h2>Codebase Analysis</h2>
                    <p>Upload your data pipeline code for dependency and flow analysis</p>
                    
                    <div class="upload-area" id="code-upload-area">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üíæ</div>
                        <h3>Drop your code files here</h3>
                        <p>Supports Python, SQL, JavaScript, TypeScript, Scala, Java</p>
                        <button class="upload-btn" onclick="document.getElementById('code-file-input').click()">
                            Choose Files
                        </button>
                        <input type="file" id="code-file-input" style="display: none;" 
                               accept=".py,.sql,.js,.ts,.scala,.java" multiple>
                    </div>
                </div>

                <div class="analysis-section" id="code-analysis" style="display: none;">
                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon code-icon">üìä</div>
                            <div class="card-title">Code Structure</div>
                        </div>
                        <div id="code-structure"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon code-icon">üîÑ</div>
                            <div class="card-title">Data Flow</div>
                        </div>
                        <div class="visualization-container" id="dataflow-viz"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon code-icon">‚ö°</div>
                            <div class="card-title">Optimization Opportunities</div>
                        </div>
                        <div id="optimizations"></div>
                    </div>
                </div>
            </div>

            <!-- KPI Analysis Tab -->
            <div class="tab-content" id="kpi">
                <div class="kpi-input">
                    <h2>KPI Requirements Analysis</h2>
                    <p>Describe your KPI requirements and get field mappings and calculation logic</p>
                    
                    <textarea class="kpi-textarea" id="kpi-description" 
                              placeholder="Describe your KPI requirements. For example: 'I need to calculate monthly customer churn rate by region, including new customers acquired and customers lost during the period.'"></textarea>
                    
                    <button class="analyze-btn" onclick="analyzeKPI()">
                        Analyze KPI Requirements
                    </button>
                </div>

                <div class="analysis-section" id="kpi-analysis" style="display: none;">
                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon kpi-icon">üìã</div>
                            <div class="card-title">Required Fields</div>
                        </div>
                        <div id="required-fields"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon kpi-icon">üóÉÔ∏è</div>
                            <div class="card-title">Source Tables & Joins</div>
                        </div>
                        <div id="source-tables"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon kpi-icon">üßÆ</div>
                            <div class="card-title">Calculation Logic</div>
                        </div>
                        <div id="calculation-logic"></div>
                    </div>
                </div>
            </div>

            <!-- Results Tab -->
            <div class="tab-content" id="results">
                <div class="analysis-section">
                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">‚ú®</div>
                            <div class="card-title">AI-Powered Improvements</div>
                        </div>
                        <div id="improvements-display"></div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">üìä</div>
                            <div class="card-title">Combined Analysis</div>
                        </div>
                        <div id="combined-analysis"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application state
        let appState = {
            databaseData: null,
            codeData: null,
            kpiData: null,
            isAnalyzing: false
        };

        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                switchTab(tabName);
            });
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }

        // File upload handlers
        function setupFileUpload(inputId, uploadAreaId, callback) {
            const input = document.getElementById(inputId);
            const uploadArea = document.getElementById(uploadAreaId);

            input.addEventListener('change', (e) => {
                callback(e.target.files);
            });

            uploadArea.addEventListener('click', () => {
                input.click();
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                callback(e.dataTransfer.files);
            });
        }

        // Initialize file uploads
        setupFileUpload('db-file-input', 'db-upload-area', handleDatabaseFiles);
        setupFileUpload('code-file-input', 'code-upload-area', handleCodeFiles);

        async function handleDatabaseFiles(files) {
            if (files.length === 0) return;

            showLoading('db-analysis');
            
            try {
                // In a real implementation, this would call the Electron IPC
                const result = await window.electronAPI?.uploadDatabaseSchema();
                
                if (result) {
                    appState.databaseData = result;
                    displayDatabaseAnalysis(result);
                    document.getElementById('db-analysis').style.display = 'block';
                    showSuccess('Database analysis completed successfully!');
                } else {
                    throw new Error('No data returned from analysis');
                }
            } catch (error) {
                showError('Database analysis failed: ' + error.message);
            }
        }

        async function handleCodeFiles(files) {
            if (files.length === 0) return;

            showLoading('code-analysis');
            
            try {
                const result = await window.electronAPI?.uploadCodeFiles();
                
                if (result) {
                    appState.codeData = result;
                    displayCodeAnalysis(result);
                    document.getElementById('code-analysis').style.display = 'block';
                    showSuccess('Code analysis completed successfully!');
                } else {
                    throw new Error('No data returned from analysis');
                }
            } catch (error) {
                showError('Code analysis failed: ' + error.message);
            }
        }

        async function analyzeKPI() {
            const description = document.getElementById('kpi-description').value.trim();
            if (!description) {
                showError('Please enter a KPI description');
                return;
            }

            showLoading('kpi-analysis');
            
            try {
                const result = await window.electronAPI?.analyzeKPIRequirements(description);
                
                if (result) {
                    appState.kpiData = result;
                    displayKPIAnalysis(result);
                    document.getElementById('kpi-analysis').style.display = 'block';
                    showSuccess('KPI analysis completed successfully!');
                } else {
                    throw new Error('No data returned from analysis');
                }
            } catch (error) {
                showError('KPI analysis failed: ' + error.message);
            }
        }

        function displayDatabaseAnalysis(data) {
            // Display schema overview
            const overview = document.getElementById('schema-overview');
            overview.innerHTML = `
                <div class="results-grid">
                    <div class="result-item">
                        <h4>Tables</h4>
                        <ul>
                            ${data.schema.tables.map(table => 
                                `<li><strong>${table.name}</strong> (${table.table_type})</li>`
                            ).join('')}
                        </ul>
                    </div>
                    <div class="result-item">
                        <h4>Total Relationships</h4>
                        <p style="font-size: 2rem; color: #667eea; font-weight: bold;">
                            ${data.relationships.length}
                        </p>
                    </div>
                </div>
            `;

            // Display relationships
            displayRelationships(data.relationships);
            
            // Display hierarchy
            displayHierarchy(data.hierarchy);
        }

        function displayCodeAnalysis(data) {
            // Display code structure
            const structure = document.getElementById('code-structure');
            structure.innerHTML = `
                <div class="results-grid">
                    <div class="result-item">
                        <h4>Files Analyzed</h4>
                        <p style="font-size: 2rem; color: #f5576c; font-weight: bold;">
                            ${data.codeStructure.files.length}
                        </p>
                    </div>
                    <div class="result-item">
                        <h4>Dependencies Found</h4>
                        <ul>
                            ${data.dependencies.slice(0, 10).map(dep => 
                                `<li>${dep}</li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
            `;

            // Display data flow
            displayDataFlow(data.dataFlow);
            
            // Display optimizations
            displayOptimizations(data.optimizations);
        }

        function displayKPIAnalysis(data) {
            // Display required fields
            const fields = document.getElementById('required-fields');
            fields.innerHTML = `
                <div class="results-grid">
                    ${data.requiredFields.map(field => 
                        `<div class="result-item">
                            <h4>${field.name}</h4>
                            <p><strong>Type:</strong> ${field.type}</p>
                            <p><strong>Description:</strong> ${field.description}</p>
                        </div>`
                    ).join('')}
                </div>
            `;

            // Display source tables
            const tables = document.getElementById('source-tables');
            tables.innerHTML = `
                <div class="results-grid">
                    ${data.sourceTables.map(table => 
                        `<div class="result-item">
                            <h4>${table.name}</h4>
                            <p><strong>Purpose:</strong> ${table.purpose}</p>
                            <p><strong>Join Type:</strong> ${table.joinType}</p>
                        </div>`
                    ).join('')}
                </div>
            `;

            // Display calculation logic
            const logic = document.getElementById('calculation-logic');
            logic.innerHTML = `
                <div class="results-grid">
                    ${data.calculations.map(calc => 
                        `<div class="result-item">
                            <h4>${calc.step}</h4>
                            <p><code>${calc.formula}</code></p>
                            <p>${calc.description}</p>
                        </div>`
                    ).join('')}
                </div>
            `;
        }

        function displayRelationships(relationships) {
            const container = document.getElementById('relationships-viz');
            container.innerHTML = '';

            if (relationships.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No relationships found</p>';
                return;
            }

            // Create a simple relationship visualization
            const relationshipHtml = relationships.map(rel => `
                <div style="margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <strong>${rel.from_table}.${rel.from_column}</strong>
                    <span class="relationship-badge">${rel.relationship_type}</span>
                    <strong>${rel.to_table}.${rel.to_column}</strong>
                </div>
            `).join('');

            container.innerHTML = relationshipHtml;
        }

        function displayHierarchy(hierarchy) {
            const container = document.getElementById('hierarchy-display');
            
            if (!hierarchy || Object.keys(hierarchy).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No hierarchy data available</p>';
                return;
            }

            function renderTree(node, level = 0) {
                const indent = '  '.repeat(level);
                if (typeof node === 'string') {
                    return `<div class="tree-node">${indent}${node}</div>`;
                } else if (Array.isArray(node)) {
                    return node.map(item => renderTree(item, level)).join('');
                } else if (typeof node === 'object') {
                    return Object.entries(node).map(([key, value]) => 
                        `<div class="tree-node ${level === 0 ? 'root' : ''}">${indent}${key}</div>` +
                        renderTree(value, level + 1)
                    ).join('');
                }
                return '';
            }

            container.innerHTML = `<div class="hierarchy-tree">${renderTree(hierarchy)}</div>`;
        }

        function displayDataFlow(dataFlow) {
            const container = document.getElementById('dataflow-viz');
            container.innerHTML = '';

            if (!dataFlow || Object.keys(dataFlow).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No data flow information available</p>';
                return;
            }

            // Simple data flow visualization
            const flowHtml = Object.entries(dataFlow).map(([source, targets]) => `
                <div style="margin: 15px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #f5576c; margin-bottom: 10px;">${source}</h4>
                    <div style="margin-left: 20px;">
                        ${Array.isArray(targets) ? targets.map(target => 
                            `<div style="padding: 5px 0;">‚Üí ${target}</div>`
                        ).join('') : `<div>‚Üí ${targets}</div>`}
                    </div>
                </div>
            `).join('');

            container.innerHTML = flowHtml;
        }

        function displayOptimizations(optimizations) {
            const container = document.getElementById('optimizations');
            
            if (!optimizations || optimizations.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No optimization suggestions available</p>';
                return;
            }

            const optimizationHtml = optimizations.map(opt => `
                <div class="improvement-item">
                    <h5>${opt.title || 'Optimization Opportunity'}</h5>
                    <p>${opt.description || opt}</p>
                </div>
            `).join('');

            container.innerHTML = optimizationHtml;
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Analyzing data...</span>
                </div>
            `;
            container.style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            // Find the active tab content and prepend the error
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(errorDiv, activeTab.firstChild);
            
            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            // Find the active tab content and prepend the success message
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(successDiv, activeTab.firstChild);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Generate improvements when we have data from multiple sources
        async function generateImprovements() {
            if (!appState.databaseData && !appState.codeData && !appState.kpiData) {
                return;
            }

            try {
                const combinedData = {
                    database: appState.databaseData,
                    code: appState.codeData,
                    kpi: appState.kpiData
                };

                const improvements = await window.electronAPI?.generateImprovements(combinedData);
                
                if (improvements) {
                    displayImprovements(improvements);
                    displayCombinedAnalysis(combinedData);
                }
            } catch (error) {
                console.error('Failed to generate improvements:', error);
            }
        }

        function displayImprovements(improvements) {
            const container = document.getElementById('improvements-display');
            
            const categories = ['performance', 'architecture', 'quality', 'monitoring'];
            const categoryTitles = {
                performance: '‚ö° Performance Optimizations',
                architecture: 'üèóÔ∏è Architecture Improvements', 
                quality: '‚úÖ Data Quality Enhancements',
                monitoring: 'üìä Monitoring Recommendations'
            };

            const improvementHtml = categories.map(category => {
                const items = improvements[category] || [];
                if (items.length === 0) return '';
                
                return `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">${categoryTitles[category]}</h3>
                        ${items.map(item => `
                            <div class="improvement-item">
                                <h5>${item.title || 'Improvement'}</h5>
                                <p>${item.description || item}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');

            container.innerHTML = improvementHtml || '<p style="text-align: center; color: #666;">No improvements generated yet. Upload data in other tabs first.</p>';
        }

        function displayCombinedAnalysis(data) {
            const container = document.getElementById('combined-analysis');
            
            let analysisHtml = '<div class="results-grid">';
            
            if (data.database) {
                analysisHtml += `
                    <div class="result-item">
                        <h4>üìä Database Insights</h4>
                        <p><strong>Tables:</strong> ${data.database.schema?.tables?.length || 0}</p>
                        <p><strong>Relationships:</strong> ${data.database.relationships?.length || 0}</p>
                    </div>
                `;
            }
            
            if (data.code) {
                analysisHtml += `
                    <div class="result-item">
                        <h4>üíª Code Insights</h4>
                        <p><strong>Files:</strong> ${data.code.codeStructure?.files?.length || 0}</p>
                        <p><strong>Dependencies:</strong> ${data.code.dependencies?.length || 0}</p>
                    </div>
                `;
            }
            
            if (data.kpi) {
                analysisHtml += `
                    <div class="result-item">
                        <h4>üìà KPI Insights</h4>
                        <p><strong>Required Fields:</strong> ${data.kpi.requiredFields?.length || 0}</p>
                        <p><strong>Source Tables:</strong> ${data.kpi.sourceTables?.length || 0}</p>
                    </div>
                `;
            }
            
            analysisHtml += '</div>';
            container.innerHTML = analysisHtml;
        }

        // Watch for data changes and auto-generate improvements
        setInterval(() => {
            if ((appState.databaseData || appState.codeData || appState.kpiData) && !appState.isAnalyzing) {
                appState.isAnalyzing = true;
                generateImprovements().finally(() => {
                    appState.isAnalyzing = false;
                });
            }
        }, 2000);

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            loadMockData();
        });
    </script>
</body>
</html>